<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECHO Project Mo√ßambique</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 600px; }
        .form-card { 
            background: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
            margin-top: 20px; 
            border-top: 8px solid #C8102E; 
        }
        .logo-container { text-align: center; margin-bottom: 15px; }
        .logo-container img { max-width: 250px; height: auto; }
        .header-main { text-align: center; margin-bottom: 30px; }
        .header-main h2 { color: #003366; font-weight: 800; font-size: 1.5rem; text-transform: uppercase; margin-top: 10px; }
        .header-main small { color: #C8102E; font-weight: 600; }
        .section-header { background: #003366; color: white; padding: 10px 15px; border-radius: 5px; margin: 25px 0 15px 0; font-weight: bold; font-size: 0.9rem; }
        .form-label { font-weight: 600; color: #003366; }
        .form-control, .form-select { border-radius: 10px; padding: 12px; border: 1px solid #ced4da; }
        .btn-submit { background-color: #003366; border: none; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1.1rem; color: white; transition: 0.3s; }
        .btn-submit:hover { background-color: #C8102E; transform: translateY(-2px); color: white; }
        /* Destaque para o campo NID */
        #nid { background-color: #fff9f9; border: 2px solid #ced4da; font-family: monospace; font-size: 1.1rem; }
        #nid:focus { border-color: #C8102E; box-shadow: 0 0 0 0.25rem rgba(200, 16, 46, 0.1); }
    </style>
</head>
<body>

<div class="container mb-5">
    <div class="form-card">
        <div class="logo-container">
            <img src="Novo logo ECHO 2025.png" alt="ECHO Project Logo" onerror="this.src='https://via.placeholder.com/250x100?text=ECHO+PROJECT'">
        </div>

        <div class="header-main">
            <h2>Projecto ECHO Mo√ßambique</h2>
            <small>App Actualiza√ß√£o de Endere√ßos</small>
        </div>

        <form id="appForm">
            <div class="section-header">üìç LOCALIZA√á√ÉO</div>
            <div class="mb-3">
                <label class="form-label">Prov√≠ncia</label>
                <select id="prov" class="form-select" required onchange="filtrarDistritos()">
                    <option value="">Seleccione a Prov√≠ncia...</option>
                    <option value="Manica">Manica</option>
                    <option value="Niassa">Niassa</option>
                    <option value="Sofala">Sofala</option>
                    <option value="Tete">Tete</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Distrito</label>
                <select id="dist" class="form-select" required disabled onchange="filtrarUS()">
                    <option value="">Seleccione o distrito...</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Unidade Sanit√°ria (US)</label>
                <select id="us" class="form-select" required disabled>
                    <option value="">Seleccione a US...</option>
                </select>
            </div>

            <div class="section-header">üÜî DADOS DO PACIENTE</div>
            <div class="mb-3">
                <label class="form-label">NID (Formato ECHO: 10/4/5 d√≠gitos)</label>
                <input type="text" id="nid" class="form-control" maxlength="21" 
                       placeholder="0000000000/0000/00000" required 
                       oninput="aplicarMascaraNID(this)">
                <div class="form-text text-danger">‚ö†Ô∏è Verifique as barras e o n√∫mero total de d√≠gitos.</div>
            </div>
            <div class="mb-3">
                <label class="form-label">Nome Completo do Paciente</label>
                <input type="text" id="nome" class="form-control" placeholder="Introduza o nome completo" required>
            </div>

            <div class="section-header">üìû CONTACTO E RESID√äNCIA</div>
            <div class="row">
                <div class="col-6 mb-3">
                    <label class="form-label">Telefone 1</label>
                    <input type="tel" id="tel1" class="form-control" pattern="8[2-7][0-9]{7}" placeholder="84..." required>
                </div>
                <div class="col-6 mb-3">
                    <label class="form-label">Telefone 2</label>
                    <input type="tel" id="tel2" class="form-control" pattern="8[2-7][0-9]{7}" placeholder="82...">
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Endere√ßo F√≠sico</label>
                <textarea id="endereco" class="form-control" rows="3" placeholder="Bairro, Quarteir√£o, Casa n¬∫..." required></textarea>
            </div>

            <div class="section-header">‚úçÔ∏è RESPONS√ÅVEL PELO REGISTO</div>
            <div class="mb-4">
                <label class="form-label">Nome do Agente / Digitador</label>
                <input type="text" id="responsavel" class="form-control" placeholder="Quem est√° a introduzir os dados?" required>
            </div>

            <button type="submit" id="btnSubmit" class="btn btn-submit w-100 shadow">SUBMETER</button>
        </form>
    </div>
</div>

<script>
// --- FUN√á√ÉO PARA A M√ÅSCARA DO NID (10/4/5) ---
function aplicarMascaraNID(input) {
    let valor = input.value.replace(/\D/g, ""); // Remove tudo o que n√£o √© n√∫mero
    if (valor.length > 19) valor = valor.slice(0, 19); // Limite m√°ximo de n√∫meros
    
    let formatado = "";
    if (valor.length > 0) {
        formatado = valor.slice(0, 10); // Primeiros 10
        if (valor.length > 10) {
            formatado += "/" + valor.slice(10, 14); // Pr√≥ximos 4
        }
        if (valor.length > 14) {
            formatado += "/" + valor.slice(14, 19); // √öltimos 5
        }
    }
    input.value = formatado;
}

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwp6sCoZqkbw9_jpBiUc5keKASUoXdSCcj_3tY9Ta_WulVwOJmpiUG_-fKr7U_UdIAoMA/exec";

const baseDados = {
    "Manica": {
        "Barue": ["Catandica HD", "Chuala CS", "Cruz de Macossa CS", "Honde CS", "Nhampassa CS", "Nhassacara CS", "Nhazonia CS"],
        "Chimoio": ["1¬∫ Maio CS", "7 de Abril CS", "Chimoio HP", "Chimoio_PCdVC", "Chissui CS", "Eduardo Mondlane CS", "Nhamaonha CS", "Vila Nova CS"],
        "Gondola": ["Amatongas CS", "Gondola Sede CS", "Inchope CS", "Muda Serra√ß√£o CS"],
        "Guro": ["Guro - Sede CS", "Mandie CS"],
        "Macate": ["Macate CS", "Marera CS", "Zembe Centro CS"],
        "Machaze": ["Bassane CS", "Chipopopo CS", "Chipudji CS", "Chitobe CS", "Mavende CS", "Mazwissanga CS", "Save CS"],
        "Manica": ["4¬∫ Congresso CS", "Machipanda CS", "Manica HD", "Messica CS"],
        "Mossurize": ["Chaiva CS", "Dacata CS", "Espungabera CS", "Garagua CS", "Gunhe CS", "Mude CS", "Mupengo CS"],
        "Sussundenga": ["Darue CS", "Dombe CS", "Munhinga CS", "Sembezea CS", "Sussundenga CS"],
        "Vanduzi": ["Chigodole CS", "IAC CS", "Matsinho CS", "Pungue Sul CS", "Vanduzi CS"]
    },
    "Niassa": {
        "Cuamba": ["Adine 3 CS", "Cuamba CS", "Cuamba HR", "Meripo CS", "Mitucu√© CS"],
        "Lago": ["Metangula CS"],
        "Lichinga": ["Chiuaula PS", "CS Lichinga", "Lichinga HP", "Lulimire CS", "Namacula CS"],
        "Mandimba": ["Mandimba CS", "Mitande CS"],
        "Mecanhelas": ["Chissaua CS", "Entre-Lagos CS", "Mecanhelas CS"],
        "Metarica": ["Metarica CS"],
        "Ngauma": ["Massangulo CS"]
    },
    "Sofala": {
        "Beira": ["Cadeia Provincial", "Cer√¢mica CS", "Chamba PS", "Chota PS", "Hospital Central da Beira HC", "M. Mascarenha CS", "Macurungo PSA", "Manga Loforte", "Manga Nhaconjo PS", "Marrocanhe", "Matadouro PS", "Munhava CS", "Nhangau CS", "Ponta G√™a PS", "Inhamizua CS"],
        "Buzi": ["Ampara PS", "Bandua CS", "Bura CS", "Buzi Sede HR", "Guara-Guara PS"],
        "Caia": ["Caia HD", "Murra√ßa CS", "Nhambalo CS", "Sena CS"],
        "Cheringoma": ["Inhaminga CS"],
        "Chibabava": ["Chibabava-Sede CS", "Hoode PS", "Mutindire CS", "Muxungue CS III"],
        "Dondo": ["Canhandula PS", "Dondo Sede CS I", "Igreja Baptista CS", "Mafambisse CS", "Maxarote PS", "Mutua PS", "Samora Machel PS", "Savane PS"],
        "Gorongosa": ["Gorongoza-Sede CS"],
        "Machanga": ["Machang CS"],
        "Marromeu": ["Marromeu HR", "Nensa CS"],
        "Nhamatanda": ["Chirassicua CS", "Lamego CS", "Metuchira Lomaco CS", "Nhamatanda HR", "Nharuchonga PS", "Siluvo PS", "Tica PS"]
    },
    "Tete": {
        "Angonia": ["D√≥mue CS", "Lifidzi CS", "Ulongue CS", "Ulongue HR"],
        "Cahora Bassa": ["Chitima CS", "Songo HR"],
        "Changara": ["Changara CS", "Dzunga CS", "M'Saua CS", "Mazoe Ponte CS"],
        "Chiuta": ["Manje CS"],
        "Macanga": ["Furancungo CS"],
        "Magoe": ["Daque CS", "Magoe CS", "Mucumbura CS"],
        "Marara": ["Boroma CS", "Cachembe CS"],
        "Moatize": ["25 de Setembro CS", "Caphirizange PS", "Cateme CS", "CFM CS", "Mameme II CS", "Moatize CS", "Ncondezi CS", "Zobue CS"],
        "Mutarara": ["Inhangoma CS", "Mutarara HR"],
        "Tete": ["Mpadue CS", "N¬∫ 1 - Bairro Magaia", "N¬∫ 2 - Bairro Matundo", "N¬∫ 3 - Bairro Manyanga", "N¬∫ 4 - Bairro Muthemba", "Tete HP"]
    }
};

function filtrarDistritos() {
    const prov = document.getElementById("prov").value;
    const distSelect = document.getElementById("dist");
    const usSelect = document.getElementById("us");
    distSelect.innerHTML = '<option value="">Seleccione o Distrito</option>';
    usSelect.innerHTML = '<option value="">Seleccione a US</option>';
    if (prov) {
        distSelect.disabled = false;
        Object.keys(baseDados[prov]).forEach(d => distSelect.options.add(new Option(d, d)));
    } else { distSelect.disabled = true; usSelect.disabled = true; }
}

function filtrarUS() {
    const prov = document.getElementById("prov").value;
    const dist = document.getElementById("dist").value;
    const usSelect = document.getElementById("us");
    usSelect.innerHTML = '<option value="">Seleccione a US</option>';
    if (dist) {
        usSelect.disabled = false;
        baseDados[prov][dist].forEach(u => usSelect.options.add(new Option(u, u)));
    } else { usSelect.disabled = true; }
}

document.getElementById('appForm').onsubmit = function(e) {
    e.preventDefault();
    const btn = document.getElementById('btnSubmit');
    const respNome = document.getElementById('responsavel').value;
    btn.disabled = true;
    btn.innerText = "A enviar dados...";

    const dados = {
        provincia: document.getElementById("prov").value,
        distrito: document.getElementById("dist").value,
        us: document.getElementById("us").value,
        nid: document.getElementById("nid").value,
        nome: document.getElementById("nome").value,
        tel1: document.getElementById("tel1").value,
        tel2: document.getElementById("tel2").value,
        endereco: document.getElementById("endereco").value,
        responsavel: respNome
    };

    fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify(dados)
    })
    .then(() => {
        alert("‚úÖ SUCESSO! Registo submetido por: " + respNome);
        document.getElementById('appForm').reset();
        filtrarDistritos(); 
    })
    .catch((error) => {
        alert("‚ùå ERRO de liga√ß√£o. Verifique a internet.");
        console.error(error);
    })
    .finally(() => {
        btn.disabled = false;
        btn.innerText = "SUBMETER";
    });
};
</script>
</body>
</html>
